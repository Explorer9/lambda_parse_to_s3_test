flowchart TD
    subgraph "Ingestion Phase"
        A[ğŸ“„ Operating Documents] --> B["ğŸ” Document Processing<br/>(AWS Lambda)"]
        B --> C{"ğŸ¯ Disclosure Detection<br/>& Segregation"}
        
        C --> D["ğŸ“‹ Extract Disclosures<br/>Store separately"]
        C --> E["ğŸ“ Process Main Content<br/>Replace/Link disclosures"]
        
        D --> F["ğŸ’¾ Disclosures Database<br/>(Amazon S3)"]
        E --> G["ğŸ“š Processed Documents<br/>with disclosure links"]
        
        F --> H["ğŸ”— Link disclosures back<br/>to source documents<br/>(metadata)"]
        G --> H
        H --> I["ğŸ§  Amazon Bedrock<br/>Knowledge Base<br/>(Combined RAG)"]
    end
    
    subgraph "Query Phase"
        J[ğŸ‘¤ Banker asks question] --> K["ğŸŒ AWS API Gateway<br/>Single Entry Point"]
        K --> L["âš¡ AWS Lambda Function<br/>Unified Query Handler"]
        
        L --> I
        I --> M["ğŸ” Retrieve relevant chunks<br/>+ Associated disclosures"]
        M --> N["ğŸ¤– Generate comprehensive answer<br/>with disclosures included"]
        N --> O[ğŸ“‹ Return answer to banker]
    end
    
    style A fill:#e3f2fd
    style F fill:#e8f5e8
    style I fill:#ff9900,color:#fff
    style K fill:#ff9900,color:#fff
    style L fill:#ff9900,color:#fff
    style O fill:#ffebee